{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PolicyClause",
  "type": "object",
  "description": "A canonical clause/criterion within a Policy, suitable for clause-aware retrieval and citation binding in the reasoning grammar.",
  "properties": {
    "policy_clause_id": { "type": "string", "format": "uuid" },
    "policy_section_id": { "type": "string", "format": "uuid" },
    "clause_ref": {
      "type": ["string", "null"],
      "description": "Optional intra-policy reference (e.g., '(a)', 'Criterion 3', 'Part B')."
    },
    "section_path": {
      "type": ["string", "null"],
      "description": "Optional heading hierarchy path (e.g., 'Chapter 4 > Policy H1 > Criterion (c)')."
    },
    "text": { "type": "string" },
    "evidence_ref": {
      "type": ["string", "null"],
      "description": "Optional stable EvidenceRef pointing to the source fragment that backs this clause text."
    },
    "speech_act": {
      "description": "Optional modality characterisation (speech act) derived as an evidence instrument; not a determination.",
      "anyOf": [{ "$ref": "PolicySpeechAct.schema.json" }, { "type": "null" }]
    },
    "conditions": {
      "type": "array",
      "description": "Inline qualifiers (unless/subject to/where appropriate) with evidence anchors.",
      "items": {
        "type": "object",
        "properties": {
          "condition_id": { "type": "string" },
          "operator": {
            "type": "string",
            "enum": ["EXCEPTION", "QUALIFICATION", "DEPENDENCY", "DISCRETION_GATE", "PRIORITY_OVERRIDE"]
          },
          "trigger_text": { "type": "string" },
          "testable": { "type": "boolean" },
          "requires": { "type": "array", "items": { "type": "string" } },
          "severity": { "type": ["string", "null"], "enum": ["hard", "soft", "discretionary", null] },
          "test_type": { "type": ["string", "null"], "enum": ["binary", "graded", "narrative", null] },
          "span_evidence_refs": {
            "type": "array",
            "items": { "$ref": "EvidenceRef.schema.json" }
          },
          "trigger_spans": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "block_id": { "type": "string" },
                "span_start": { "type": ["integer", "null"] },
                "span_end": { "type": ["integer", "null"] },
                "span_quality": { "type": ["string", "null"] },
                "evidence_ref": { "$ref": "EvidenceRef.schema.json" }
              }
            }
          }
        },
        "required": ["condition_id", "operator", "trigger_text", "span_evidence_refs"]
      }
    },
    "metadata": { "type": "object" }
  },
  "required": ["policy_clause_id", "policy_section_id", "text"]
}
